{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Messages</title>
    <link rel="stylesheet" href="{% static 'css/facebookhome.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
 
    <style>
      /* Friend Requests page styles (desktop first) - full width layout */
      .requests-container{width:100%;max-width:none;margin:12px 0;display:grid;grid-template-columns:260px 1fr;gap:16px;padding:12px 24px;box-sizing:border-box}
      .left-nav{background:#fff;border-radius:8px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
      .left-nav h3{margin:6px 0 12px;font-size:18px}
      .left-nav .nav-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;color:#050505;cursor:pointer}
      .left-nav .nav-item i{width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:6px;background:#F0F2F5;color:#1877F2}
      .left-nav .nav-item.active{background:#F0F2F5}

      .requests-main{background:transparent}
      .requests-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
      .requests-header h2{margin:0;font-size:20px}
      .see-all{color:#4b4f56;font-size:14px}

      /* Grid of cards */
      .requests-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
      .req-card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.04);display:flex;flex-direction:column}
      .req-image{width:100%;height:160px;object-fit:cover;display:block}
      .req-body{padding:12px;display:flex;flex-direction:column;gap:8px}
      .req-name{font-size:15px;font-weight:700;color:#050505}
      .req-mutual{font-size:13px;color:#6b7280}
      .req-actions{display:flex;gap:8px;margin-top:6px}
      .btn-confirm{background:#1877F2;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;flex:1;font-weight:600}
      .btn-delete{background:#f2f3f5;color:#111;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;flex:1}

      /* small screens: stack single column */
      @media (max-width:900px){
        .requests-container{grid-template-columns:1fr;padding:12px}
        .left-nav{order:2}
        .requests-main{order:1}
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <!-- Left section -->
      <div class="header-left">
        <div class="logo">
          <i class="fab fa-facebook"></i>
        </div>
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search Facebook" />
        </div>
      </div>

      <!-- Center navigation -->
      <div class="header-center">
        <a href="{% url 'Homepage' %}" class="nav-icon active">
          <i class="fas fa-home"></i>
        </a>
        <a href="video_page" class="nav-icon">
          <i class="fas fa-play"></i>
        </a>
        <a href="market_page" class="nav-icon">
          <i class="fas fa-store"></i>
        </a>
        <a href="friends_page" class="nav-icon">
          <i class="fas fa-users"></i>
        </a>
        <a href="#" class="nav-icon">
          <i class="fas fa-gamepad"></i>
        </a>
      </div>

      <!-- Right section -->
      <div class="header-right">
        <div class="action-button">
          <i class="fas fa-plus"></i>
        </div>
        <div class="action-button">
          <a href="message_page"><i class="fab fa-facebook-messenger"></i></a>
        </div>
        <div class="action-button">
          <a href="requests_page"><i class="fas fa-bell"></i></a>
        </div>
        <div class="user-profile">
          <a href="{% url 'User_Profile' %}"
            ><img src="{% static "image/contact1.jpeg" %}" alt="Profile"></a
          >
        </div>
      </div>
    </header>
    <br />
    <br />
    <br />

    <div class="requests-container">
      <!-- Left nav (Friends menu) -->
      <nav class="left-nav" aria-label="Friends navigation">
        <h3>Friends</h3>
        <div class="nav-item active">
          <i class="fas fa-home"></i>
          <span>Home</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-user-plus"></i>
          <span>Friend Requests</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-user-friends"></i>
          <span>Suggestions</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-users"></i>
          <span>All friends</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-birthday-cake"></i>
          <span>Birthdays</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-list"></i>
          <span>Custom Lists</span>
        </div>
      </nav>

      <!-- Main requests area -->
      <main class="requests-main">
        <div class="requests-header">
          <h2>Friend Requests</h2>
          <a class="see-all" href="#">See All</a>
        </div>

        <!-- Requests Grid -->
        <div class="requests-grid" aria-live="polite">
          {% for request in incoming_requests %}
            <div class="req-card">
              <img class="req-image" src="{% static 'image/contact1.jpeg' %}" alt="{{ request.from_user.get_full_name }}">
              <div class="req-body">
                <div class="req-name">{{ request.from_user.get_full_name|default:request.from_user.username }}</div>
                <div class="req-mutual">0 mutual friends</div>
                <div class="req-actions">
                  <button class="btn-confirm" onclick="acceptRequest({{ request.id }}, event)">Confirm</button>
                  <button class="btn-delete" onclick="deleteRequest({{ request.id }}, event)">Delete</button>
                </div>
              </div>
            </div>
          {% empty %}
            <div style="grid-column:1/-1;padding:18px;color:#6b7280;text-align:center">
              No incoming friend requests.
            </div>
          {% endfor %}
        </div>
      </main>
    </div>

    <script>
      function getCookie(name) {
        const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
        return v ? v.pop() : '';
      }

      function acceptRequest(frId, e) {
        e.preventDefault();
        const csrftoken = getCookie('csrftoken');
        fetch('/api/accept_request/', {
          method: 'POST',
          credentials: 'same-origin',
          headers: {'X-CSRFToken': csrftoken, 'Content-Type': 'application/x-www-form-urlencoded'},
          body: `fr_id=${encodeURIComponent(frId)}`
        }).then(resp => {
          if(resp.ok) location.reload();
        });
      }

      function deleteRequest(frId, e) {
        e.preventDefault();
        const csrftoken = getCookie('csrftoken');
        fetch('/api/delete_request/', {
          method: 'POST',
          credentials: 'same-origin',
          headers: {'X-CSRFToken': csrftoken, 'Content-Type': 'application/x-www-form-urlencoded'},
          body: `fr_id=${encodeURIComponent(frId)}`
        }).then(resp => {
          if(resp.ok) location.reload();
        });
      }

      // Refresh requests every 10 seconds
      setInterval(() => location.reload(), 10000);
    </script>


  </body>
</html>